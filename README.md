# Port Service

Микросервис для управления сущностями портов на Go с использованием хексагональной архитектуры, современного тестирования и контейнеризации через Docker.

## Описание

Port Service — это RESTful HTTP API для управления данными морских портов. Приложение поддерживает загрузку, обновление, получение информации о портах и хранение данных в in-memory repository. Структура проекта построена по принципам хексагональной (шестигранной) архитектуры, что даёт высокую модульность и чистоту кода.

## Архитектура

### Хексагональная архитектура (Hexagonal / Ports & Adapters)

- **Доменный слой (`internal/domain`)**: Описывает бизнес-энтити и интерфейсы хранилища портов. Вся бизнес-логика инкапсулирована здесь.
- **Сервисный слой (`internal/services`)**: Реализует доменные use case, отделяя бизнес-логику от инфраструктуры.
- **Инфраструктурный слой (адаптеры)**:
    - **Http Transport (`internal/transport`)**: HTTP-эндпоинты, валидирует и преобразует входные модели, вызывает сервисы.
    - **Реализация репозиториев (`internal/repository/inmem`)**: In-memory реализация интерфейса хранилища для быстрой работы и тестирования, легко заменить на другие источники (PostgreSQL, Redis и т.д.).
- **Общие компоненты (`internal/common`)**: Общие типы ошибок и утилиты для правильной структуры ошибок, ответов и т.д.
- **Конфиг (`internal/config`)**: Инкапсулирует параметры окружения и запуска.

### Практики и подходы

- **Dependency Injection** — зависимости внедряются через конструкторы, а не через глобальные переменные.
- **Чистая обработка ошибок** — собственные типы ошибок и централизованный мидлвар для ошибок.
- **Тестирование** — модульные и e2e тесты (`*_test.go`), покрытие transport/repository.
- **Инкапсуляция бизнес-логики** и строгая модульность.
- **Встроенная сериализация/десериализация JSON** с помощью стандартных библиотек.
- **Иммутабельность данных** в доменном слое.
- **Изоляция инфраструктуры** — легко добавить другие адаптеры без изменений бизнес-логики.
- **Контейнеризация** через Docker и Docker Compose для стандартизированных деплоев и локальной разработки.

## Технологии

- Язык: Go 1.20+
- Docker + Docker Compose (dev environment)
- HTTP API (REST)
- Тестирование: go test, testify
- Работа с JSON
- Стандартные библиотеки (net/http, context и др.)

## Структура проекта
```
.
├── app
├── cmd
│ └── port-service
├── docker-compose.yml
├── Dockerfile
├── go.mod
├── go.sum
├── internal
│ ├── common
│ │ ├── errors
│ │ └── server
│ ├── config
│ ├── domain
│ ├── repository
│ ├── services
│ └── transport
│ ├── http_e2e_test.go
│ ├── http.go
│ ├── model.go
│ ├── testfixtures
│ └── utils.go
├── Makefile
└── ports.json
```

## Основные команды для запуска

### Через Docker Compose

Для быстрого старта и локальной разработки:

```
docker-compose up --build
```

### Без контейнеров (локально)

1. Сборка бинарного файла:

```
go build -o port-service ./cmd/port-service
```

2. Запуск приложения:

```
./port-service
```

Порт и другие параметры настраиваются через переменные окружения (см. `internal/config/config.go`).

## Тестирование

Модульные и интеграционные тесты:

```
go test ./internal/...
```

Для e2e тестов (например, проверка upload и загрузки JSON-портов):
```
go test ./internal/transport/...
```

## HTTP API

### Эндпоинты

- `POST /ports` — загрузка новых портов (bulk или по одному), JSON в теле.
- `GET /ports?id=PORT_ID` — получить порт по id.
- `GET /count` — получить количество портов.

### Пример использования

```
curl -X POST http://localhost:8000/ports -d @ports.json --header "Content-Type: application/json"
```

## Как расширить и масштабировать

Архитектура позволяет добавить другие реализации репозиториев (например, подключить PostgreSQL), не меняя транспорт и бизнес-логику. Нужно реализовать новый адаптер в пакете repository и зарегистрировать его в main.

## Дополнительные подходы

- Строгий separation of concerns (чистое разделение слоёв и модулей).
- Использование стандартных и de facto best practices разработки на Go.
- Лёгкая тестируемость каждого уровня.
- Поддержка Graceful Shutdown через context и signal-обработку.
- Plug-and-play: можно заменить adapters без влияния на главную логику.
